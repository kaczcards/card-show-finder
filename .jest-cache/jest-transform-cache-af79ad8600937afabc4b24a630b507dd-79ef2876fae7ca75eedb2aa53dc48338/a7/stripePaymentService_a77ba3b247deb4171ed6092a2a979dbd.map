{"version":3,"names":["supabase","SUBSCRIPTION_PLANS","_calculateExpiryDate","calculateExpiryDate","SubscriptionPlanType","SubscriptionDuration","UserRole","STRIPE_PUBLISHABLE_KEY","cov_2672s7zqdg","s","_env","EXPO_PUBLIC_STRIPE_PUBLISHABLE_KEY","SUPABASE_EDGE_FUNCTION_URL","EXPO_PUBLIC_SUPABASE_URL","initializeStripe","f","b","console","error","createPaymentSheetForSubscription","_ref","_asyncToGenerator","userId","planId","initPaymentSheet","presentPaymentSheet","plan","find","p","id","success","_ref2","auth","getSession","session","data","accessToken","access_token","response","fetch","method","headers","Object","assign","Authorization","body","JSON","stringify","amount","price","currency","ok","errorBody","json","Error","_ref3","paymentIntent","ephemeralKey","customer","_ref4","merchantDisplayName","customerId","customerEphemeralKeySecret","paymentIntentClientSecret","allowsDelayedPaymentMethods","returnURL","initError","logPayment","user_id","plan_id","status","transaction_id","error_message","message","_ref5","presentError","code","processSubscriptionUpdate","transactionId","_x","_x2","_x3","_x4","apply","arguments","_ref6","expiryDate","newRole","type","MVP_DEALER","SHOW_ORGANIZER","updateUserProfileWithSubscription","toISOString","DEALER","duration","MONTHLY","rpc","p_user_id","p_payment_id","p_paid_at","Date","rpcErr","_x5","_x6","_x7","_ref7","expiryDateISO","_ref8","from","update","role","subscription_status","payment_status","subscription_expiry","updated_at","eq","_x8","_x9","_x0","_ref9","paymentData","_ref0","insert","_x1"],"sources":["stripePaymentService.ts"],"sourcesContent":["import { StripeProvider as _StripeProvider, useStripe as _useStripe } from '@stripe/stripe-react-native';\nimport { supabase } from '../supabase';\n// The helper in `subscriptionTypes` was accidentally exported with an underscore –\n// alias it locally so we can keep the nice name in the rest of this file.\nimport {\n  SubscriptionPlan,\n  SUBSCRIPTION_PLANS,\n  _calculateExpiryDate as calculateExpiryDate,\n  SubscriptionPlanType,\n  SubscriptionDuration,\n} from './subscriptionTypes';\nimport { UserRole } from './userRoleService';\n\n// --- Type Definitions ---\n\n/**\n * Represents the outcome of a payment operation.\n */\nexport interface StripePaymentResult {\n  success: boolean;\n  error?: string;\n  transactionId?: string;\n}\n\n/**\n * Defines the expected JSON response from the backend (Supabase Edge Function)\n * when creating a payment intent.\n */\ninterface PaymentIntentResponse {\n  paymentIntent: string; // The Payment Intent client secret\n  ephemeralKey: string;  // The Ephemeral Key secret for the customer\n  customer: string;      // The Stripe Customer ID\n  publishableKey: string; // The Stripe publishable key\n}\n\n/**\n * Defines the structure for logging a payment transaction in Supabase.\n */\ninterface PaymentLog {\n  id?: string;\n  user_id: string;\n  plan_id: string;\n  amount: number;\n  currency: string;\n  status: 'succeeded' | 'failed' | 'pending';\n  transaction_id: string; // Stripe Payment Intent ID\n  error_message?: string;\n  created_at?: string;\n}\n\n// --- Constants ---\n\n// It's crucial to load this from environment variables and not hardcode it.\nconst STRIPE_PUBLISHABLE_KEY = process.env.EXPO_PUBLIC_STRIPE_PUBLISHABLE_KEY;\nconst SUPABASE_EDGE_FUNCTION_URL = `${process.env.EXPO_PUBLIC_SUPABASE_URL}/functions/v1/create-payment-intent`;\n\n// --- Service Implementation ---\n\n/**\n * Initializes the Stripe SDK.\n * This should be called once at the root of your application.\n * @returns {_boolean} True if initialization was successful, false otherwise.\n */\nexport const initializeStripe = (): boolean => {\n  if (!STRIPE_PUBLISHABLE_KEY) {\n    console.error('Stripe publishable key is not set. Please check your environment variables.');\n    return false;\n  }\n  // The StripeProvider component handles initialization. This function is for validation.\n  return true;\n};\n\n/**\n * Creates and presents the Stripe Payment Sheet for a given subscription plan.\n * This function orchestrates the entire client-side payment flow.\n *\n * @param userId - The ID of the user purchasing the subscription.\n * @param planId - The ID of the subscription plan being purchased.\n * @param initPaymentSheet - The `initPaymentSheet` function from the `useStripe` hook.\n * @param presentPaymentSheet - The `presentPaymentSheet` function from the `useStripe` hook.\n * @returns {Promise<StripePaymentResult>} The result of the payment operation.\n */\nexport const createPaymentSheetForSubscription = async (\n  userId: string,\n  planId: string,\n  initPaymentSheet: (params: any) => Promise<any>,\n  presentPaymentSheet: () => Promise<any>\n): Promise<StripePaymentResult> => {\n  const plan = SUBSCRIPTION_PLANS.find((p) => p.id === planId);\n  if (!plan) {\n    return { success: false, error: 'Subscription plan not found.' };\n  }\n\n  try {\n    // 1. Create a payment intent on the server (via Supabase Edge Function)\n\n    // -----------------------------------------------------------\n    // Retrieve the current access-token from Supabase auth session\n    // -----------------------------------------------------------\n    const {\n      data: { session },\n    } = await supabase.auth.getSession();\n\n    const accessToken = session?.access_token;\n\n    const response = await fetch(SUPABASE_EDGE_FUNCTION_URL, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        // Pass the access token only if we actually have one\n        ...(accessToken ? { Authorization: `Bearer ${accessToken}` } : {}),\n      },\n      body: JSON.stringify({\n        amount: plan.price * 100, // Stripe expects amount in cents\n        currency: 'usd',\n        userId: userId,\n        planId: plan.id,\n      }),\n    });\n\n    if (!response.ok) {\n      const errorBody = await response.json();\n      throw new Error(errorBody.error || 'Failed to create payment intent.');\n    }\n\n    const {\n      paymentIntent,\n      ephemeralKey,\n      customer,\n    }: PaymentIntentResponse = await response.json();\n\n    // 2. Initialize the Payment Sheet\n    const { error: initError } = await initPaymentSheet({\n      merchantDisplayName: 'Card Show Finder, LLC.',\n      customerId: customer,\n      customerEphemeralKeySecret: ephemeralKey,\n      paymentIntentClientSecret: paymentIntent,\n      allowsDelayedPaymentMethods: true,\n      returnURL: 'cardshowfinder://stripe-redirect', // Custom URL scheme\n    });\n\n    if (initError) {\n      console.error('Stripe initPaymentSheet error:', initError);\n      await logPayment({\n        user_id: userId,\n        plan_id: plan.id,\n        amount: plan.price,\n        currency: 'usd',\n        status: 'failed',\n        transaction_id: paymentIntent,\n        error_message: `Init Error: ${initError.message}`,\n      });\n      return { success: false, error: `Initialization failed: ${initError.message}` };\n    }\n\n    // 3. Present the Payment Sheet\n    const { error: presentError } = await presentPaymentSheet();\n\n    if (presentError) {\n      // User cancelled or payment failed\n      if (presentError.code === 'Canceled') {\n        return { success: false, error: 'Payment was canceled.' };\n      }\n      console.error('Stripe presentPaymentSheet error:', presentError);\n      await logPayment({\n        user_id: userId,\n        plan_id: plan.id,\n        amount: plan.price,\n        currency: 'usd',\n        status: 'failed',\n        transaction_id: paymentIntent,\n        error_message: `Present Error: ${presentError.message}`,\n      });\n      return { success: false, error: `Payment failed: ${presentError.message}` };\n    }\n\n    // 4. Payment succeeded, process the subscription\n    await processSubscriptionUpdate(userId, plan, paymentIntent);\n\n    return { success: true, transactionId: paymentIntent };\n\n  } catch (error: any) {\n    console.error('An unexpected error occurred during payment:', error);\n    return { success: false, error: error.message || 'An unknown error occurred.' };\n  }\n};\n\n/**\n * Handles the logic after a successful payment: calculates expiry, updates the user's profile,\n * and logs the transaction.\n *\n * @param userId - The ID of the user.\n * @param plan - The subscription plan that was purchased.\n * @param transactionId - The Stripe Payment Intent ID for logging.\n */\nexport const processSubscriptionUpdate = async (\n  userId: string,\n  plan: SubscriptionPlan,\n  transactionId: string\n): Promise<void> => {\n  try {\n    /**\n     * Calculate the expiry date for the **paid** subscription.\n     * We intentionally ignore any free-trial data here because an upgrade\n     * should terminate the trial and start the paid period immediately.\n     * The helper in `subscriptionTypes` already encodes:\n     *   • Annual  → +365 days\n     *   • Monthly → +30  days\n     */\n    const expiryDate = calculateExpiryDate(plan);\n\n    // Determine the new role based on the subscription type\n    const newRole =\n      plan.type === 'dealer' ? UserRole.MVP_DEALER : UserRole.SHOW_ORGANIZER;\n\n    // Update user profile in Supabase\n    await updateUserProfileWithSubscription(\n      userId,\n      newRole,\n      expiryDate.toISOString(),\n    );\n\n    // Log the successful payment\n    await logPayment({\n      user_id: userId,\n      plan_id: plan.id,\n      amount: plan.price,\n      currency: 'usd',\n      status: 'succeeded',\n      transaction_id: transactionId,\n    });\n\n    // --- Organizer referral earnings (dealer monthly only) -----------------\n    if (\n      plan.type === SubscriptionPlanType.DEALER &&\n      plan.duration === SubscriptionDuration.MONTHLY\n    ) {\n      try {\n        await supabase.rpc('award_referral_on_payment', {\n          p_user_id: userId,\n          p_payment_id: transactionId,\n          p_paid_at: new Date().toISOString(),\n        });\n      } catch (rpcErr: any) {\n        // Non-critical: log & continue\n        console.error('award_referral_on_payment RPC failed:', rpcErr);\n      }\n    }\n\n  } catch (error: any) {\n    console.error(\n      'Failed to process subscription update after payment:',\n      error,\n    );\n    // Even if post-payment processing fails, the payment was successful.\n    // This should be handled with a reconciliation process or monitoring.\n    // For now, we log the error.\n    await logPayment({\n      user_id: userId,\n      plan_id: plan.id,\n      amount: plan.price,\n      currency: 'usd',\n      status: 'failed', // Log as 'failed' to indicate a processing failure post-payment\n      transaction_id: transactionId,\n      error_message: 'Post-payment profile update failed.',\n    });\n  }\n};\n\n/**\n * Updates the user's profile in the Supabase 'profiles' table with new subscription details.\n *\n * @param userId - The user's ID.\n * @param newRole - The new role to assign to the user.\n * @param expiryDateISO - The ISO string of the subscription expiry date.\n */\nconst updateUserProfileWithSubscription = async (\n  userId: string,\n  newRole: UserRole,\n  expiryDateISO: string\n): Promise<void> => {\n  const { error } = await supabase\n    .from('profiles')\n    .update({\n      role: newRole,\n      subscription_status: 'active',\n      // Mark the user as having completed payment so UI does not show “Trial” banners\n      payment_status: 'paid',\n      subscription_expiry: expiryDateISO,\n      updated_at: new Date().toISOString(),\n    })\n    .eq('id', userId);\n\n  if (error) {\n    console.error('Error updating user profile with subscription:', error);\n    throw new Error('Failed to update user profile after payment.');\n  }\n};\n\n/**\n * Logs a payment transaction to the 'payments' table in Supabase.\n *\n * @param paymentData - The payment details to log.\n */\nconst logPayment = async (paymentData: PaymentLog): Promise<void> => {\n  const { error } = await supabase.from('payments').insert(paymentData);\n\n  if (error) {\n    console.error('Error logging payment transaction:', error);\n    // This is a non-critical error for the user flow, but important for analytics/debugging.\n  }\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}