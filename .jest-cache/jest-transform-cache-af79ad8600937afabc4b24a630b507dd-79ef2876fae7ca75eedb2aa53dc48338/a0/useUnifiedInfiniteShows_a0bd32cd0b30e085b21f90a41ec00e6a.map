{"version":3,"names":["useInfiniteShows","useShowsInfiniteQuery","cov_1tj5joz3ti","s","useUnifiedInfiniteShows","params","_ref3","_ref4","_pages$","f","shouldUseRpc","b","keyword","trim","length","Array","isArray","dealerCardTypes","_ref","coordinates","_ref$radius","radius","_ref$startDate","startDate","Date","_ref$endDate","endDate","setDate","getDate","maxEntryFee","features","categories","_ref$pageSize","pageSize","_ref$enabled","enabled","featuresRecord","forEach","feature","_ref2","lat","latitude","lng","longitude","undefined","Object","keys","useLegacyFallback","data","fetchNextPage","hasNextPage","isFetchingNextPage","isLoading","isError","queryError","error","refetch","pages","flattenedShows","flatMap","page","shows","totalCount","pagination","errorMessage","message","refresh","_ref5","_asyncToGenerator","apply","arguments","_fetchNextPage2","isRefreshing"],"sources":["useUnifiedInfiniteShows.ts"],"sourcesContent":["import { useInfiniteShows, InfiniteShowsParams, InfiniteShowsResult } from './useInfiniteShows';\nimport { useShowsInfiniteQuery } from './useShowsAdvancedQuery.rpc';\nimport { Show } from '../types';\n\n/**\n * Unified hook for infinite shows fetching that chooses between:\n * 1. RPC-based advanced query (when keyword or dealerCardTypes are used)\n * 2. Legacy client-side filtering (for basic filtering)\n * \n * Maintains the same parameter and result interface as useInfiniteShows\n * for seamless integration with existing components.\n * \n * @param params - Filtering parameters and coordinates\n * @returns An object with shows data, loading states, and functions to fetch more data\n */\nexport const useUnifiedInfiniteShows = (params: InfiniteShowsParams): InfiniteShowsResult => {\n  // Determine if we should use the RPC path\n  const shouldUseRpc = \n    (typeof params.keyword === 'string' && params.keyword.trim().length > 0) || \n    (Array.isArray(params.dealerCardTypes) && params.dealerCardTypes.length > 0);\n  \n  // If no advanced filtering is needed, use the legacy path\n  if (!shouldUseRpc) {\n    return useInfiniteShows(params);\n  }\n  \n  // Otherwise, use the RPC path with advanced filtering capabilities\n  const {\n    coordinates,\n    radius = 25,\n    startDate = new Date(),\n    endDate = new Date(new Date().setDate(new Date().getDate() + 30)),\n    maxEntryFee,\n    features,\n    categories,\n    keyword,\n    dealerCardTypes,\n    pageSize = 20,\n    enabled = true,\n  } = params;\n\n  // Convert features array to Record<string, boolean> if needed\n  const featuresRecord: Record<string, boolean> = {};\n  if (Array.isArray(features) && features.length > 0) {\n    features.forEach(feature => {\n      featuresRecord[feature] = true;\n    });\n  }\n\n  // Use the RPC-based infinite query\n  const {\n    data,\n    fetchNextPage,\n    hasNextPage,\n    isFetchingNextPage,\n    isLoading,\n    isError,\n    error: queryError,\n    refetch,\n  } = useShowsInfiniteQuery(\n    {\n      lat: coordinates.latitude,\n      lng: coordinates.longitude,\n      radius,\n      startDate: startDate ?? undefined,\n      endDate: endDate ?? undefined,\n      maxEntryFee,\n      categories,\n      features: Object.keys(featuresRecord).length > 0 ? featuresRecord : undefined,\n      keyword,\n      dealerCardTypes,\n      pageSize,\n      useLegacyFallback: true, // Enable fallback to ensure we always get results\n    },\n    // Cast options as any to bypass strict generic type requirements\n    { enabled } as any\n  );\n  \n  // Safely access pages to avoid TS complaints about `.pages`\n  const pages = (data as any)?.pages as Array<{ shows: Show[]; pagination: any }> | undefined;\n\n  // Flatten the pages of shows into a single array\n  const flattenedShows: Show[] = pages ? pages.flatMap((page: any) => page.shows) : [];\n  \n  // Get the total count from the first page (or 0 if no data)\n  const totalCount = pages?.[0]?.pagination?.totalCount || 0;\n  \n  // Extract error message if any\n  const errorMessage = isError ? (queryError as Error)?.message || 'Failed to load shows' : null;\n  \n  // Create a refresh function that wraps refetch\n  const refresh = async (): Promise<void> => {\n    await refetch();\n  };\n  \n  return {\n    shows: flattenedShows,\n    totalCount,\n    hasNextPage: !!hasNextPage,\n    fetchNextPage: async () => {\n      if (hasNextPage && !isFetchingNextPage) {\n        await fetchNextPage();\n      }\n    },\n    refresh,\n    isLoading,\n    isFetchingNextPage,\n    isRefreshing: false, // This would need to be tracked separately if needed\n    error: errorMessage,\n  };\n};\n\nexport default useUnifiedInfiniteShows;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAASA,gBAAgB,QAAkD,oBAAoB;AAC/F,SAASC,qBAAqB,QAAQ,6BAA6B;AAACC,cAAA,GAAAC,CAAA;AAcpE,OAAO,IAAMC,uBAAuB,GAAG,SAA1BA,uBAAuBA,CAAIC,MAA2B,EAA0B;EAAA,IAAAC,KAAA,EAAAC,KAAA,EAAAC,OAAA;EAAAN,cAAA,GAAAO,CAAA;EAE3F,IAAMC,YAAY,IAAAR,cAAA,GAAAC,CAAA,OACf,CAAAD,cAAA,GAAAS,CAAA,iBAAON,MAAM,CAACO,OAAO,KAAK,QAAQ,MAAAV,cAAA,GAAAS,CAAA,UAAIN,MAAM,CAACO,OAAO,CAACC,IAAI,CAAC,CAAC,CAACC,MAAM,GAAG,CAAC,KACtE,CAAAZ,cAAA,GAAAS,CAAA,UAAAI,KAAK,CAACC,OAAO,CAACX,MAAM,CAACY,eAAe,CAAC,MAAAf,cAAA,GAAAS,CAAA,UAAIN,MAAM,CAACY,eAAe,CAACH,MAAM,GAAG,CAAC,CAAC;EAACZ,cAAA,GAAAC,CAAA;EAG/E,IAAI,CAACO,YAAY,EAAE;IAAAR,cAAA,GAAAS,CAAA;IAAAT,cAAA,GAAAC,CAAA;IACjB,OAAOH,gBAAgB,CAACK,MAAM,CAAC;EACjC,CAAC;IAAAH,cAAA,GAAAS,CAAA;EAAA;EAGD,IAAAO,IAAA,IAAAhB,cAAA,GAAAC,CAAA,OAYIE,MAAM;IAXRc,WAAW,GAAAD,IAAA,CAAXC,WAAW;IAAAC,WAAA,GAAAF,IAAA,CACXG,MAAM;IAANA,MAAM,GAAAD,WAAA,eAAAlB,cAAA,GAAAS,CAAA,UAAG,EAAE,IAAAS,WAAA;IAAAE,cAAA,GAAAJ,IAAA,CACXK,SAAS;IAATA,SAAS,GAAAD,cAAA,eAAApB,cAAA,GAAAS,CAAA,UAAG,IAAIa,IAAI,CAAC,CAAC,IAAAF,cAAA;IAAAG,YAAA,GAAAP,IAAA,CACtBQ,OAAO;IAAPA,OAAO,GAAAD,YAAA,eAAAvB,cAAA,GAAAS,CAAA,UAAG,IAAIa,IAAI,CAAC,IAAIA,IAAI,CAAC,CAAC,CAACG,OAAO,CAAC,IAAIH,IAAI,CAAC,CAAC,CAACI,OAAO,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,IAAAH,YAAA;IACjEI,WAAW,GAAAX,IAAA,CAAXW,WAAW;IACXC,QAAQ,GAAAZ,IAAA,CAARY,QAAQ;IACRC,UAAU,GAAAb,IAAA,CAAVa,UAAU;IACVnB,OAAO,GAAAM,IAAA,CAAPN,OAAO;IACPK,eAAe,GAAAC,IAAA,CAAfD,eAAe;IAAAe,aAAA,GAAAd,IAAA,CACfe,QAAQ;IAARA,QAAQ,GAAAD,aAAA,eAAA9B,cAAA,GAAAS,CAAA,UAAG,EAAE,IAAAqB,aAAA;IAAAE,YAAA,GAAAhB,IAAA,CACbiB,OAAO;IAAPA,OAAO,GAAAD,YAAA,eAAAhC,cAAA,GAAAS,CAAA,UAAG,IAAI,IAAAuB,YAAA;EAIhB,IAAME,cAAuC,IAAAlC,cAAA,GAAAC,CAAA,OAAG,CAAC,CAAC;EAACD,cAAA,GAAAC,CAAA;EACnD,IAAI,CAAAD,cAAA,GAAAS,CAAA,UAAAI,KAAK,CAACC,OAAO,CAACc,QAAQ,CAAC,MAAA5B,cAAA,GAAAS,CAAA,UAAImB,QAAQ,CAAChB,MAAM,GAAG,CAAC,GAAE;IAAAZ,cAAA,GAAAS,CAAA;IAAAT,cAAA,GAAAC,CAAA;IAClD2B,QAAQ,CAACO,OAAO,CAAC,UAAAC,OAAO,EAAI;MAAApC,cAAA,GAAAO,CAAA;MAAAP,cAAA,GAAAC,CAAA;MAC1BiC,cAAc,CAACE,OAAO,CAAC,GAAG,IAAI;IAChC,CAAC,CAAC;EACJ,CAAC;IAAApC,cAAA,GAAAS,CAAA;EAAA;EAGD,IAAA4B,KAAA,IAAArC,cAAA,GAAAC,CAAA,OASIF,qBAAqB,CACvB;MACEuC,GAAG,EAAErB,WAAW,CAACsB,QAAQ;MACzBC,GAAG,EAAEvB,WAAW,CAACwB,SAAS;MAC1BtB,MAAM,EAANA,MAAM;MACNE,SAAS,GAAAjB,KAAA,IAAAJ,cAAA,GAAAS,CAAA,UAAEY,SAAS,aAAAjB,KAAA,IAAAJ,cAAA,GAAAS,CAAA,UAAIiC,SAAS;MACjClB,OAAO,GAAAnB,KAAA,IAAAL,cAAA,GAAAS,CAAA,WAAEe,OAAO,aAAAnB,KAAA,IAAAL,cAAA,GAAAS,CAAA,WAAIiC,SAAS;MAC7Bf,WAAW,EAAXA,WAAW;MACXE,UAAU,EAAVA,UAAU;MACVD,QAAQ,EAAEe,MAAM,CAACC,IAAI,CAACV,cAAc,CAAC,CAACtB,MAAM,GAAG,CAAC,IAAAZ,cAAA,GAAAS,CAAA,WAAGyB,cAAc,KAAAlC,cAAA,GAAAS,CAAA,WAAGiC,SAAS;MAC7EhC,OAAO,EAAPA,OAAO;MACPK,eAAe,EAAfA,eAAe;MACfgB,QAAQ,EAARA,QAAQ;MACRc,iBAAiB,EAAE;IACrB,CAAC,EAED;MAAEZ,OAAO,EAAPA;IAAQ,CACZ,CAAC;IAzBCa,IAAI,GAAAT,KAAA,CAAJS,IAAI;IACJC,cAAa,GAAAV,KAAA,CAAbU,aAAa;IACbC,WAAW,GAAAX,KAAA,CAAXW,WAAW;IACXC,kBAAkB,GAAAZ,KAAA,CAAlBY,kBAAkB;IAClBC,SAAS,GAAAb,KAAA,CAATa,SAAS;IACTC,OAAO,GAAAd,KAAA,CAAPc,OAAO;IACAC,UAAU,GAAAf,KAAA,CAAjBgB,KAAK;IACLC,OAAO,GAAAjB,KAAA,CAAPiB,OAAO;EAqBT,IAAMC,KAAK,IAAAvD,cAAA,GAAAC,CAAA,QAAI6C,IAAI,oBAAJA,IAAI,CAAUS,KAAK,CAAyD;EAG3F,IAAMC,cAAsB,IAAAxD,cAAA,GAAAC,CAAA,QAAGsD,KAAK,IAAAvD,cAAA,GAAAS,CAAA,WAAG8C,KAAK,CAACE,OAAO,CAAC,UAACC,IAAS,EAAK;IAAA1D,cAAA,GAAAO,CAAA;IAAAP,cAAA,GAAAC,CAAA;IAAA,OAAAyD,IAAI,CAACC,KAAK;EAAD,CAAC,CAAC,KAAA3D,cAAA,GAAAS,CAAA,WAAG,EAAE;EAGpF,IAAMmD,UAAU,IAAA5D,cAAA,GAAAC,CAAA,QAAG,CAAAD,cAAA,GAAAS,CAAA,WAAA8C,KAAK,aAAAjD,OAAA,GAALiD,KAAK,CAAG,CAAC,CAAC,cAAAjD,OAAA,GAAVA,OAAA,CAAYuD,UAAU,qBAAtBvD,OAAA,CAAwBsD,UAAU,MAAA5D,cAAA,GAAAS,CAAA,WAAI,CAAC;EAG1D,IAAMqD,YAAY,IAAA9D,cAAA,GAAAC,CAAA,QAAGkD,OAAO,IAAAnD,cAAA,GAAAS,CAAA,WAAG,CAAAT,cAAA,GAAAS,CAAA,WAAC2C,UAAU,oBAAVA,UAAU,CAAYW,OAAO,MAAA/D,cAAA,GAAAS,CAAA,WAAI,sBAAsB,MAAAT,cAAA,GAAAS,CAAA,WAAG,IAAI;EAACT,cAAA,GAAAC,CAAA;EAG/F,IAAM+D,OAAO;IAAA,IAAAC,KAAA,GAAAC,iBAAA,CAAG,aAA2B;MAAAlE,cAAA,GAAAO,CAAA;MAAAP,cAAA,GAAAC,CAAA;MACzC,MAAMqD,OAAO,CAAC,CAAC;IACjB,CAAC;IAAA,gBAFKU,OAAOA,CAAA;MAAA,OAAAC,KAAA,CAAAE,KAAA,OAAAC,SAAA;IAAA;EAAA,GAEZ;EAACpE,cAAA,GAAAC,CAAA;EAEF,OAAO;IACL0D,KAAK,EAAEH,cAAc;IACrBI,UAAU,EAAVA,UAAU;IACVZ,WAAW,EAAE,CAAC,CAACA,WAAW;IAC1BD,aAAa;MAAA,IAAAsB,eAAA,GAAAH,iBAAA,CAAE,aAAY;QAAAlE,cAAA,GAAAO,CAAA;QAAAP,cAAA,GAAAC,CAAA;QACzB,IAAI,CAAAD,cAAA,GAAAS,CAAA,WAAAuC,WAAW,MAAAhD,cAAA,GAAAS,CAAA,WAAI,CAACwC,kBAAkB,GAAE;UAAAjD,cAAA,GAAAS,CAAA;UAAAT,cAAA,GAAAC,CAAA;UACtC,MAAM8C,cAAa,CAAC,CAAC;QACvB,CAAC;UAAA/C,cAAA,GAAAS,CAAA;QAAA;MACH,CAAC;MAAA,SAJDsC,aAAaA,CAAA;QAAA,OAAAsB,eAAA,CAAAF,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAbrB,aAAa;IAAA,GAIZ;IACDiB,OAAO,EAAPA,OAAO;IACPd,SAAS,EAATA,SAAS;IACTD,kBAAkB,EAAlBA,kBAAkB;IAClBqB,YAAY,EAAE,KAAK;IACnBjB,KAAK,EAAES;EACT,CAAC;AACH,CAAC;AAED,eAAe5D,uBAAuB","ignoreList":[]}