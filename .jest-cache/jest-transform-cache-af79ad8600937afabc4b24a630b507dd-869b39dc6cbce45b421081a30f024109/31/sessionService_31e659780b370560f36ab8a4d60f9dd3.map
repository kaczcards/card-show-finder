{"version":3,"names":["supabase","cov_ok4zfbnid","s","refreshUserSession","_ref","_asyncToGenerator","f","_ref2","auth","refreshSession","error","b","console","success","err","apply","arguments","isSessionValid","_ref3","_ref4","getSession","data","session","getCurrentUserId","_ref5","_data$session","_ref6","user","id"],"sources":["sessionService.ts"],"sourcesContent":["// src/services/sessionService.ts\n\nimport { supabase } from '../supabase';\n\n/**\n * Forces Supabase to refresh the current JWT/session so that any recent\n * changes to the user's profile (e.g., role upgrades) are immediately\n * reflected in `supabase.auth`.\n * \n * This function is extracted to its own service to avoid circular dependencies\n * between AuthContext, userRoleService, and supabaseAuthService.\n */\nexport const refreshUserSession = async (): Promise<{ success: boolean; error?: any }> => {\n  try {\n    const { error } = await supabase.auth.refreshSession();\n    if (error) {\n      console.error('Error refreshing Supabase session:', error);\n      return { success: false, error };\n    }\n    return { success: true };\n  } catch (err) {\n    console.error('Unexpected error in refreshUserSession:', err);\n    return { success: false, error: err };\n  }\n};\n\n/**\n * Checks if the current user session is valid\n * @returns Boolean indicating if the session is valid\n */\nexport const isSessionValid = async (): Promise<boolean> => {\n  try {\n    const { data } = await supabase.auth.getSession();\n    return !!data.session;\n  } catch (err) {\n    console.error('Error checking session validity:', err);\n    return false;\n  }\n};\n\n/**\n * Gets the current user ID from the session\n * @returns User ID string or null if not authenticated\n */\nexport const getCurrentUserId = async (): Promise<string | null> => {\n  try {\n    const { data } = await supabase.auth.getSession();\n    return data.session?.user?.id || null;\n  } catch (err) {\n    console.error('Error getting current user ID:', err);\n    return null;\n  }\n};\n"],"mappings":"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","ignoreList":[]}